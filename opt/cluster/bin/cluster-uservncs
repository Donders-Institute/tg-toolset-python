#!/bin/bash

# get vncserver sessions information from ganglia
# reprocess to get vnc sessions per user
wget -O - -q "http://ganglia/rawdata.php?c=Mentat Cluster&cols[]=vncservers.VAL&noheader" |
grep '^mentat[0-8]' |
awk 'NF > 1 {
	for (i=2; i<=NF ; i++) {
		user=$i; 
		sub(":[0-9]*", "", user); 
		vncnum=$i; 
		sub(".*:", "", vncnum); 
		vncs[user] = vncs[user] " " $1 ":" vncnum
	}
} 
END {
	for (user in vncs) { 
		printf("%-10s %s\n", user, vncs[user])
	}
}' |
sort
                                                               
