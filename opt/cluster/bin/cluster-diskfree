#!/bin/bash


#machine            total     used    avail      use
#---------------------------------------------------
#mentat001           216G      33G     173G      16%

echo
echo "Mentat Cluster"
echo -e "\e[7m--------------\e[27m"
echo

wget -O - -q "http://ganglia/rawdata.php?c=Mentat Cluster&cols[]=disk_free.VAL&cols[]=disk_total.VAL&noheader" |

sort -b -k2n,2|
awk '
BEGIN{
	IFS="\t"
	printf ("%-19s %8s  %8s  %8s  %8s\n", "machine", "total", "used", "avail", "use")
	printf ("%-19s-%8s--%8s--%8s--%8s\n", "-------------------", "--------","--------",  "--------",  "--------" )
	}
NF > 2{
	total=($3+0)
	avail=($2+0)
	used=(total-avail)
	use=100*(used/total)
	printf ("%-10s  %8.1fG %8.1fG %8.1fG %8.1f%%\n", $1, total, used, avail, use)
}'

echo
echo "Torque Cluster"
echo -e "\e[7m--------------\e[27m"
echo

wget -O - -q "http://ganglia/rawdata.php?c=Torque Cluster&cols[]=disk_free.VAL&cols[]=disk_total.VAL&noheader" |

sort -b -k2n,2|
awk '
BEGIN{
	IFS="\t"
	printf ("%-19s %8s  %8s  %8s  %8s\n", "machine", "total", "used", "avail", "use")
	printf ("%-19s-%8s--%8s--%8s--%8s\n", "-------------------", "--------","--------",  "--------",  "--------" )
	}
NF > 2{
	total=($3+0)
	avail=($2+0)
	used=(total-avail)
	use=100*(used/total)
	printf ("%-10s  %8.1fG %8.1fG %8.1fG %8.1f%%\n", $1, total, used, avail, use)
}'
